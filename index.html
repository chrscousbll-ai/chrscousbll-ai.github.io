<!DOCTYPE html>
<html>
<head>
  <title>Vegetation Mapping</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; width: 100%; }
    .legend {
      background: white;
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
    .legend button {
      display: block;
      margin: 4px 0;
      width: 100%;
      padding: 6px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="legend" id="legend"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Vegetation types with colors
    const vegetationTypes = {
      "Forest": "green",
      "Grass": "lime",
      "Wetland": "blue",
      "Shrub": "brown",
      "Dead Tree": "gray"
    };

    let map = L.map("map").setView([45.0, -69.0], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19
    }).addTo(map);

    let currentType = null;
    let currentLine = null;
    let allLines = [];

    // Build legend buttons
    const legendDiv = document.getElementById("legend");
    for (let type in vegetationTypes) {
      const btn = document.createElement("button");
      btn.innerText = type;
      btn.style.background = vegetationTypes[type];
      btn.onclick = () => {
        currentType = type;
        currentLine = null; // reset so we always start a fresh line
      };
      legendDiv.appendChild(btn);
    }

    // Add point on map click
    map.on("click", function(e) {
      if (!currentType) {
        alert("Select a vegetation type first!");
        return;
      }

      if (!currentLine) {
        // Start a new polyline for this type
        currentLine = L.polyline([e.latlng], { color: vegetationTypes[currentType] }).addTo(map);
        allLines.push(currentLine);
      } else {
        // Continue the current line
        currentLine.addLatLng(e.latlng);
      }
    });
  </script>
</body>
</html>
